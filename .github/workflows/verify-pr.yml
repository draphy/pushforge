name: Verify PRs

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]

jobs:
  pr-title-check:
    name: PR Title Check
    runs-on: ubuntu-latest
    steps:
      - name: Check PR Title
        shell: bash
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
        run: |
          echo "Checking PR title: $PR_TITLE"

          # Define valid types
          VALID_TYPES="feat|fix|bug|doc|ci|release|test"

          # Regular expression pattern for PR title validation
          if ! [[ "$PR_TITLE" =~ ^($VALID_TYPES):[[:space:]]\[(WPN-[0-9]+(,[[:space:]]*WPN-[0-9]+)*)\][[:space:]][A-Z].* ]]; then
            echo "::error::PR title does not match the required pattern!"
            echo "::error::Required format: <type>: [<issue-number>] <title>"
            echo "::error::Where:"
            echo "::error::- type: Must be one of: feat, fix, bug, doc, ci, release, test"
            echo "::error::- issue-number: Must be WPN-X or multiple like [WPN-1, WPN-2]"
            echo "::error::- title: Must start with a capital letter"
            echo "::error::"
            echo "::error::Valid examples:"
            echo "::error::- feat: [WPN-1] Implement user authentication"
            echo "::error::- fix: [WPN-42] Fix memory leak in notification service"
            echo "::error::- doc: [WPN-7, WPN-8] Update API documentation"
            echo "::error::- ci: [WPN-15] Add performance testing to pipeline"
            echo "::error::"
            echo "::error::Your title: \"$PR_TITLE\""
            exit 1
          else
            echo "âœ… PR title format is valid!"
          fi
